# Custom LaTeX Extensions

A custom LaTeX extension will need

- a `texToTex` function that transform the provided content into valid LaTeX markup
- a `texToHtml` function that transform the provided content into HTML markup
- LaTeX options in the plugin config for LaTeX markup around the content
- `svelteScripts`, `sveltePreContent`, `sveltePostContent` to inject Svelte markup around the content

export interface TexExtensionOptions {
latexOptions?: LatexOptions;
texToHtml: (x: string) => [string, Set<string>?];
texToTex: (x: string) => string;
svelteScripts?: string;
sveltePreContent?: string;
sveltePostContent?: string;
}

Creating a custom tex extension thus involves supplying these to the plugin.

This is done by the `exts` plugin option, which is an object with the
new extension name as the key and the following options:

## Example plugin config

```ts
// vite.config.ts (or js)
import { sveltekit } from "@sveltejs/kit/vite";
import { mathlified } from "vite-plugin-sveltekit-tex";
export default {
	plugins: [
    sveltekit(),
    mathlified({
      texExts: {
        myTex: {
          latexOptions: {
            latexCmd: "pdflatex";
          }
          texToHtml: (x:string)=>[x],
          texToTex: (x:string)=>x,
          svelteScripts: `const title = 'My Title';`,
          sveltePreContent = `<h1>{title}</h1>`;
          sveltePostContent = `<style>\n\th1 {\n\t\tcolor: 'red';\n\t}\n</style>`
        }
      }
    })
  ],
};
```

The above example now add a new extension,
`**/*.myTex.tex`. This skeleton example's `texToHtml` and `texToTex` functions
just return the content without modification. You will probably want to implement
your own functionality there. Refer to the source code for how the default
`mathlified.tex` extension tackles using markdown-style sectioning and converts
LaTeX markup to HTML.

## Using mathlifier features in `texToHtml`

The Mathlifier library is used in the default `mathlified.tex` extension
to create readable Svelte source code. It will mean importing the relevant
functions from the Mathlifier library.

The output of the `texToHtml` function is an array. The first element
is the Svelte markup string, while the second element is a Set of functions
that should be imported from the Mathlifier library.

### Example

Say we have the following LaTeX markup, which uses inline and display math.

```tex
% src/lib/mathlified/sample.myTex.tex
This example uses inline math $x$, display math
$$ ax^2 + bx + c = 0. $$
```

We can then define our `texToHtml` to return
a set with `math, display` as the
relevant Mathlifier functions we want to use in our Svelte markup.

```ts
function texToHtml(x: string): [string, Set<string>] {
	return [transformString(x), new Set(["math", "display"])];
}
```

An example Svelte markup will then be

```svelte
<!-- src/routes/sample/+page.svelte -->
<script lang="ts">
  import { math, display } from 'mathlifier'
  const title = 'My Title'; // from plugin config
</script>
<!-- from plugin sveltePreContent -->
<h1>{title}</h1>

<!--content generated by transformString in texToHtml -->

This example uses inline math {@html math('x')}, display math
{@html display(' ax^2+bx+c=0 ')}

<!-- from plugin sveltePostContent -->
<style>
  h1 {
    color: 'red';
  }
</style>
```
